<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/styles/common.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
    <link rel="manifest" href="/assets/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painee</title>
</head>
<body>
    <div class="app-bar">
        <div class="app-icon">
        <img src="/assets/favicon-32x32.png" alt="App Icon" width="24" height="24">
        </div>
        <div class="app-title">
        Painee
        </div>
        <div class="app-links">
        <a href="#" class="app-link">Home</a>
        <a href="#" class="app-link">About</a>
        <a href="#" class="app-link">Services</a>
        <a href="#" class="app-link">Contact</a>
        </div>
    </div>
    <div class="container">
        <form id="target-form">
            <input
            class="w-100"
            type="text"
            id="target-input"
            name="target"
            placeholder="Target"
            maxlength="100"
            required
            >
            
            <ol id="remedy-ol">
                <li id="remedy-item-template">
                    <input
                        class="w-100"
                        type="text"
                        name="condition"
                        placeholder="If foo happens..."
                        maxlength="100"
                        required
                    >
                    <div class="w-100 flex-center-h">
                        <input
                            class="mv flex-grow"
                            type="text"
                            name="remedy-statement"
                            placeholder="Do bar"
                            maxlength="100"
                            style="min-width: 4em;"
                            required
                        >
                        <input
                            type="number"
                            name="remedy-n"
                            class="mh inp-s"
                            placeholder="N"
                        >
                        <select name="remedy-unit">
                            <option value="" selected disabled hidden>Unit</option>
                            <!-- {{#each units}} -->
                            <!-- <option value="{{value}}">{{label}}</option> -->
                            <!-- {{/each}} -->
                            <option value="Times">Times</option>
                        </select>
                    </div>
                    <div class="mv">
                        <button type="button" class="delete-remedy-btn">Delete</button>
                    </div>
                </li>
            </ol>
            
            <button type="button" id="add-remedy-btn">Add Remedy</button>
            <br>
            
            <input
                class="w-100 mv"
                type="text"
                name="penalty"
                placeholder="Penalty"
                id="penalty-input"
                maxlength="100"
            >
            <br>
            
            <label for="until-input">Until</label>
            <input
                class="w-100"
                type="datetime-local"
                name="until"
                id="until-input"
                required
            >
            
            <button class="w-100 mv" type="submit">Submit</button>
        </form>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
</body>
<script>
$(document).ready(function () {
    const remedyItemTemplate = $("#remedy-item-template").clone();
    remedyItemTemplate.removeAttr('id');
    remedyItemTemplate.find("input").val("");
    $("#add-remedy-btn").click(function() {
        $("#remedy-ol").append(remedyItemTemplate.clone());
    });

    $(document).on("click", ".delete-remedy-btn", function () {
        $(this).closest("li").remove();
    });
    $("#target-form").on("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission

        // Create JSON object with form data
        const formData = {
            target: $("#target-input").val(),
            remedies: $('#remedy-ol li').map(function () {
                const unit = $(this).find("[name='remedy-unit'] :selected").val();
                const n = $(this).find("input[name='remedy-n']").val();
                return {
                    "condition": $(this).find("input[name='condition']").val(),
                    "statement": $(this).find("input[name='remedy-statement']").val(),
                    ...(unit && n && { "unit": [unit, Number(n)] })
                };
            }).get(),
            penalty: $("#penalty-input").val(),
            until: new Date($("#until-input").val()).toISOString()
        };

        // Perform POST request to the server with the JSON data
        $.ajax({
            url: "save-target",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (data) {
                console.log("Server response:", data);
                // Handle server response here
            },
            error: function (error) {
                console.error("Error submitting form:", error);
                // Handle error here
            },
        });
    });
});
</script>
</html>